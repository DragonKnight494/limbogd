<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LIMBO Key Focus</title>

<style>
  body {
    margin: 0;
    background: black;
    overflow: hidden;
    touch-action: manipulation;
  }

  .keys {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: grid;
    grid-template-columns: repeat(4, minmax(70px, 120px));
    gap: 20px;
  }

  .key {
    aspect-ratio: 1 / 1;
    background: red;
    border-radius: 14px;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 0.15s, box-shadow 0.15s, transform 0.15s;
    cursor: pointer;
  }

  .key img {
    width: 65%;
    pointer-events: none;
  }

  .active {
    background: #00ff66;
    box-shadow: 0 0 30px #00ff66, 0 0 60px #00ff66;
  }

  .jitter {
    animation: jitter 0.15s infinite;
  }

  @keyframes jitter {
    0% { transform: translate(0,0); }
    25% { transform: translate(8px,-8px); }
    50% { transform: translate(-8px,8px); }
    75% { transform: translate(8px,8px); }
    100% { transform: translate(0,0); }
  }

  /* SCREEN FLASH */
  .flash {
    animation: flash 0.12s;
  }

  @keyframes flash {
    from { background: white; }
    to { background: black; }
  }

  /* RESULT ICON */
  .result {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 35vw;
    max-font-size: 220px;
    font-weight: bold;
    opacity: 0;
    pointer-events: none;
  }

  .show {
    opacity: 1;
  }

  .check { color: #00ff66; }
  .x { color: red; }
</style>
</head>

<body>

<div class="keys" id="keys">
  <div class="key"><img src="key.png"></div>
  <div class="key"><img src="key.png"></div>
  <div class="key"><img src="key.png"></div>
  <div class="key"><img src="key.png"></div>
  <div class="key"><img src="key.png"></div>
  <div class="key"><img src="key.png"></div>
  <div class="key"><img src="key.png"></div>
  <div class="key"><img src="key.png"></div>
</div>

<div class="result check" id="check">✔</div>
<div class="result x" id="x">✖</div>

<script>
  const keysContainer = document.getElementById("keys");
  const keys = Array.from(document.querySelectorAll(".key"));
  const check = document.getElementById("check");
  const xMark = document.getElementById("x");

  let activeKey = null;
  let canSelect = false;

  // SIMPLE SOUND EFFECTS (no files needed)
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  function beep(freq, duration) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.frequency.value = freq;
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
    osc.stop(audioCtx.currentTime + duration);
  }

  function shuffleKeys() {
    keys.sort(() => Math.random() - 0.5);
    keys.forEach(k => keysContainer.appendChild(k));
  }

  function startCycle() {
    canSelect = false;
    check.classList.remove("show");
    xMark.classList.remove("show");

    keys.forEach(k => {
      k.classList.remove("active", "jitter");
      k.style.transform = "rotate(0deg)";
    });

    shuffleKeys();

    activeKey = keys[Math.floor(Math.random() * keys.length)];
    activeKey.classList.add("active", "jitter");
    activeKey.style.transform = `rotate(${Math.random() * 360}deg)`;

    document.body.classList.add("flash");
    beep(900, 0.08);

    setTimeout(() => {
      document.body.classList.remove("flash");
    }, 120);

    // Stop chaos after 2–3 seconds
    setTimeout(() => {
      activeKey.classList.remove("jitter");
      canSelect = true;
      beep(500, 0.1);
    }, 2000 + Math.random() * 1000);
  }

  function handleSelect(key) {
    if (!canSelect) return;

    canSelect = false;

    if (key === activeKey) {
      check.classList.add("show");
      beep(1200, 0.15);
    } else {
      xMark.classList.add("show");
      beep(200, 0.2);
    }

    setTimeout(startCycle, 1800);
  }

  keys.forEach(key => {
    key.addEventListener("click", () => handleSelect(key));
    key.addEventListener("touchstart", () => handleSelect(key), { passive: true });
  });

  startCycle();
</script>

</body>
</html>
